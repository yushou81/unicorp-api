# 第四次迭代测试计划

## 1. 测试目标

本测试计划旨在验证第四次迭代中实现的"资源共享中心"功能，包括资源的上传、浏览、管理和下载功能。

## 2. 测试环境

- 操作系统：Windows 10/11 或 macOS
- 数据库：MySQL 8.0
- JDK版本：17
- 浏览器：Chrome/Firefox/Edge 最新版
- 测试工具：Postman、JUnit

## 3. 测试范围

### 3.1 功能测试

1. 文件上传功能
2. 资源创建功能
3. 资源列表查询功能
4. 资源详情查询功能
5. 资源更新功能
6. 资源删除功能
7. 权限控制测试

### 3.2 非功能测试

1. 性能测试（文件上传和下载速度）
2. 安全测试（权限验证）
3. 兼容性测试（不同浏览器）

## 4. 测试用例

### 4.1 文件上传功能测试

| 测试ID | 测试项 | 前置条件 | 测试步骤 | 预期结果 | 实际结果 |
|--------|-------|---------|---------|---------|---------|
| FU-001 | 上传有效文件 | 用户已登录 | 1. 调用文件上传接口<br>2. 上传一个有效的PDF文件 | 返回200状态码和文件URL | |
| FU-002 | 上传过大文件 | 用户已登录 | 1. 调用文件上传接口<br>2. 上传一个>10MB的文件 | 返回413状态码和错误信息 | |
| FU-003 | 上传空文件 | 用户已登录 | 1. 调用文件上传接口<br>2. 上传一个空文件 | 返回400状态码和错误信息 | |

### 4.2 资源管理功能测试

| 测试ID | 测试项 | 前置条件 | 测试步骤 | 预期结果 | 实际结果 |
|--------|-------|---------|---------|---------|---------|
| RM-001 | 创建资源 | 用户已登录且为教师/导师 | 1. 调用资源创建接口<br>2. 提供有效的资源信息 | 返回201状态码和资源详情 | |
| RM-002 | 非教师/导师创建资源 | 用户已登录但非教师/导师 | 1. 调用资源创建接口<br>2. 提供有效的资源信息 | 返回403状态码和错误信息 | |
| RM-003 | 查询资源列表 | 无 | 1. 调用资源列表接口<br>2. 提供分页参数 | 返回200状态码和资源列表 | |
| RM-004 | 带关键词查询资源列表 | 无 | 1. 调用资源列表接口<br>2. 提供关键词参数 | 返回200状态码和符合关键词的资源列表 | |
| RM-005 | 查询资源详情 | 资源已存在 | 1. 调用资源详情接口<br>2. 提供有效的资源ID | 返回200状态码和资源详情 | |
| RM-006 | 查询不存在的资源 | 无 | 1. 调用资源详情接口<br>2. 提供不存在的资源ID | 返回404状态码和错误信息 | |
| RM-007 | 更新资源 | 用户已登录且为资源所有者 | 1. 调用资源更新接口<br>2. 提供有效的更新信息 | 返回200状态码和更新后的资源详情 | |
| RM-008 | 非所有者更新资源 | 用户已登录但非资源所有者 | 1. 调用资源更新接口<br>2. 提供有效的更新信息 | 返回403状态码和错误信息 | |
| RM-009 | 删除资源 | 用户已登录且为资源所有者 | 1. 调用资源删除接口<br>2. 提供有效的资源ID | 返回204状态码 | |
| RM-010 | 非所有者删除资源 | 用户已登录但非资源所有者 | 1. 调用资源删除接口<br>2. 提供有效的资源ID | 返回403状态码和错误信息 | |

### 4.3 文件上传和个人资料功能测试

| 测试ID | 测试项 | 前置条件 | 测试步骤 | 预期结果 | 实际结果 |
|--------|-------|---------|---------|---------|---------|
| FP-001 | 上传头像文件 | 用户已登录 | 1. 调用文件上传接口<br>2. 指定type=avatar<br>3. 上传一个有效的图片文件 | 返回200状态码和文件URL | |
| FP-002 | 更新用户头像 | 用户已登录，已上传头像文件 | 1. 调用更新头像接口<br>2. 提供有效的头像URL | 返回200状态码和成功消息 | |
| FP-003 | 上传简历文件 | 学生用户已登录 | 1. 调用文件上传接口<br>2. 指定type=resume<br>3. 上传一个有效的PDF文件 | 返回200状态码和文件URL | |
| FP-004 | 更新学生简历 | 学生用户已登录，已上传简历文件 | 1. 调用更新简历接口<br>2. 提供有效的简历URL | 返回200状态码和成功消息 | |
| FP-005 | 非学生用户更新简历 | 非学生用户已登录 | 1. 调用更新简历接口<br>2. 提供有效的简历URL | 返回403状态码和错误消息 | |

## 5. Postman测试集合

### 5.1 环境设置

1. 创建一个名为"校企合作平台-第四次迭代"的环境
2. 添加以下变量：
   - `baseUrl`: http://localhost:8081/api
   - `token`: （登录后获取的JWT令牌）

### 5.2 测试脚本

#### 5.2.1 用户登录

```
POST {{baseUrl}}/v1/auth/login
Content-Type: application/json

{
  "loginType": "account",
  "principal": "teacher1",
  "password": "password123"
}

// 测试脚本
pm.test("登录成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.data.token).to.not.be.null;
    pm.environment.set("token", jsonData.data.token);
});
```

#### 5.2.2 上传文件

```
POST {{baseUrl}}/v1/files/upload
Authorization: Bearer {{token}}
Content-Type: multipart/form-data

file: [选择文件]

// 测试脚本
pm.test("文件上传成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.data.file_url).to.not.be.null;
    pm.environment.set("fileUrl", jsonData.data.file_url);
});
```

#### 5.2.3 创建资源

```
POST {{baseUrl}}/v1/resources
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Java编程基础教程",
  "description": "适合初学者的Java编程入门教程",
  "resourceType": "技术文档",
  "fileUrl": "{{fileUrl}}"
}

// 测试脚本
pm.test("资源创建成功", function () {
    pm.response.to.have.status(201);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.data.id).to.not.be.null;
    pm.environment.set("resourceId", jsonData.data.id);
});
```

#### 5.2.4 获取资源列表

```
GET {{baseUrl}}/v1/resources?page=0&size=10
Content-Type: application/json

// 测试脚本
pm.test("获取资源列表成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.data.list).to.be.an('array');
});
```

#### 5.2.5 获取资源详情

```
GET {{baseUrl}}/v1/resources/{{resourceId}}
Content-Type: application/json

// 测试脚本
pm.test("获取资源详情成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.data.id).to.equal(parseInt(pm.environment.get("resourceId")));
});
```

#### 5.2.6 更新资源

```
PUT {{baseUrl}}/v1/resources/{{resourceId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Java编程基础教程（更新版）",
  "description": "适合初学者的Java编程入门教程，包含最新Java特性",
  "resourceType": "技术文档",
  "fileUrl": "{{fileUrl}}"
}

// 测试脚本
pm.test("资源更新成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.data.title).to.include("更新版");
});
```

#### 5.2.7 删除资源

```
DELETE {{baseUrl}}/v1/resources/{{resourceId}}
Authorization: Bearer {{token}}

// 测试脚本
pm.test("资源删除成功", function () {
    pm.response.to.have.status(204);
});
```

#### 5.2.8 上传头像文件

```
POST {{baseUrl}}/v1/files/upload
Authorization: Bearer {{token}}
Content-Type: multipart/form-data

file: [选择图片文件]
type: avatar

// 测试脚本
pm.test("头像文件上传成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.data.file_url).to.not.be.null;
    pm.environment.set("avatarUrl", jsonData.data.file_url);
});
```

#### 5.2.9 更新用户头像

```
POST {{baseUrl}}/v1/me/profile/avatar
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "avatarUrl": "{{avatarUrl}}"
}

// 测试脚本
pm.test("头像更新成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.message).to.include("头像更新成功");
});
```

#### 5.2.10 上传简历文件

```
POST {{baseUrl}}/v1/files/upload
Authorization: Bearer {{token}}
Content-Type: multipart/form-data

file: [选择PDF文件]
type: resume

// 测试脚本
pm.test("简历文件上传成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.data.file_url).to.not.be.null;
    pm.environment.set("resumeUrl", jsonData.data.file_url);
});
```

#### 5.2.11 更新学生简历

```
POST {{baseUrl}}/v1/me/profile/resume
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "resumeUrl": "{{resumeUrl}}"
}

// 测试脚本
pm.test("简历更新成功", function () {
    pm.response.to.have.status(200);
    var jsonData = pm.response.json();
    pm.expect(jsonData.code).to.equal(200);
    pm.expect(jsonData.message).to.include("简历更新成功");
});
```

## 6. 测试执行计划

1. 准备测试环境和测试数据
2. 执行单元测试
3. 执行API集成测试
4. 执行前端UI测试
5. 记录测试结果和问题
6. 修复问题并重新测试
7. 完成测试报告

## 7. 测试报告模板

### 7.1 测试摘要

- 测试执行日期：
- 测试人员：
- 测试版本：
- 测试结果总结：

### 7.2 测试详情

| 测试ID | 测试结果 | 问题描述 | 严重程度 | 状态 |
|--------|---------|---------|---------|------|
|        |         |         |         |      |

### 7.3 问题跟踪

| 问题ID | 问题描述 | 严重程度 | 修复状态 | 修复日期 |
|--------|---------|---------|---------|---------|
|        |         |         |         |         |

### 7.4 结论和建议

- 测试结论：
- 改进建议： 