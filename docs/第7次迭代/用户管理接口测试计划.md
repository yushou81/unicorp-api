# 用户管理接口测试计划

## 测试环境
- 后端API地址：http://localhost:8081/api
- 测试工具：Postman
- 测试账号：系统管理员账号（账号：00000001，密码：123456）

## 测试前准备
1. 启动后端服务
2. 使用系统管理员账号登录获取JWT令牌
   ```
   POST /v1/auth/login
   Content-Type: application/json
   
   {
     "loginType": "account",
     "principal": "00000001",
     "password": "123456"
   }
   ```
3. 将获取到的token保存，在后续请求中使用

## 测试用例

### 1. 获取用户列表

#### 1.1 获取所有用户（不包括系统管理员）
```
GET /v1/admin/users?page=1&size=10
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：200
- 返回分页的用户列表，不包含系统管理员角色的用户
- 包含用户的基本信息（ID、账号、昵称、邮箱、手机号、状态、所属组织等）

#### 1.2 根据角色筛选用户
```
GET /v1/admin/users?page=1&size=10&role=STUDENT
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：200
- 返回分页的学生用户列表
- 每个用户的role字段值为"STUDENT"

### 2. 修改用户状态

#### 2.1 激活用户
```
PUT /v1/admin/users/{userId}/status
Authorization: Bearer {token}
Content-Type: application/json

{
  "status": "active"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的用户信息，status字段值为"active"
- 数据库中对应用户的status字段已更新

#### 2.2 禁用用户
```
PUT /v1/admin/users/{userId}/status
Authorization: Bearer {token}
Content-Type: application/json

{
  "status": "inactive"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的用户信息，status字段值为"inactive"
- 数据库中对应用户的status字段已更新

#### 2.3 尝试修改系统管理员状态
```
PUT /v1/admin/users/{系统管理员userId}/status
Authorization: Bearer {token}
Content-Type: application/json

{
  "status": "inactive"
}
```

**预期结果**：
- 状态码：400
- 返回错误信息："不能修改系统管理员状态"

### 3. 修改用户基本信息

#### 3.1 修改用户昵称
```
PUT /v1/admin/users/{userId}
Authorization: Bearer {token}
Content-Type: application/json

{
  "nickname": "新昵称"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的用户信息，nickname字段值为"新昵称"
- 数据库中对应用户的nickname字段已更新

#### 3.2 修改用户邮箱
```
PUT /v1/admin/users/{userId}
Authorization: Bearer {token}
Content-Type: application/json

{
  "email": "newemail@example.com"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的用户信息，email字段值为"newemail@example.com"
- 数据库中对应用户的email字段已更新

#### 3.3 修改用户手机号
```
PUT /v1/admin/users/{userId}
Authorization: Bearer {token}
Content-Type: application/json

{
  "phone": "13900001234"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的用户信息，phone字段值为"13900001234"
- 数据库中对应用户的phone字段已更新

#### 3.4 同时修改多个字段
```
PUT /v1/admin/users/{userId}
Authorization: Bearer {token}
Content-Type: application/json

{
  "nickname": "全新昵称",
  "email": "brandnew@example.com",
  "phone": "13988889999"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的用户信息，包含所有更新的字段
- 数据库中对应用户的相关字段已全部更新

#### 3.5 使用已存在的邮箱
```
PUT /v1/admin/users/{userId}
Authorization: Bearer {token}
Content-Type: application/json

{
  "email": "已存在的邮箱地址"
}
```

**预期结果**：
- 状态码：400
- 返回错误信息："该邮箱已被其他用户使用"

#### 3.6 尝试修改系统管理员信息
```
PUT /v1/admin/users/{系统管理员userId}
Authorization: Bearer {token}
Content-Type: application/json

{
  "nickname": "新系统管理员"
}
```

**预期结果**：
- 状态码：400
- 返回错误信息："不能修改系统管理员信息"

## 使用Postman进行测试

1. **创建环境变量**
   - 创建一个新的环境，命名为"Unicorp API测试"
   - 添加变量：
     - `baseUrl`: http://localhost:8081/api
     - `token`: 留空（将在登录后填充）

2. **创建登录请求**
   - 创建POST请求：`{{baseUrl}}/v1/auth/login`
   - 添加请求体：
     ```json
     {
       "loginType": "account",
       "principal": "00000001",
       "password": "123456"
     }
     ```
   - 添加测试脚本，自动提取token：
     ```javascript
     var jsonData = pm.response.json();
     if (jsonData && jsonData.data && jsonData.data.token) {
         pm.environment.set("token", jsonData.data.token);
     }
     ```

3. **创建集合**
   - 创建一个名为"用户管理接口"的集合
   - 将所有测试用例添加到集合中
   - 对每个请求：
     - 设置URL为`{{baseUrl}}/v1/admin/users/...`
     - 添加Authorization头：`Bearer {{token}}`
     - 添加适当的请求体和参数

4. **运行测试**
   - 先运行登录请求获取token
   - 然后运行其他请求进行测试
   - 验证每个请求的响应是否符合预期

5. **保存测试结果**
   - 将测试结果导出为HTML或JSON格式，以便记录和分析 