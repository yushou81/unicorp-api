# 企业管理员接口测试计划

## 测试环境
- 后端API地址：http://localhost:8081/api
- 测试工具：Postman
- 测试账号：企业管理员账号（需要提前准备）

## 测试前准备
1. 启动后端服务
2. 使用企业管理员账号登录获取JWT令牌
   ```
   POST /v1/auth/login
   Content-Type: application/json
   
   {
     "loginType": "account",
     "principal": "企业管理员账号",
     "password": "密码"
   }
   ```
3. 将获取到的token保存，在后续请求中使用

## 测试用例

### 1. 获取导师列表

```
GET /v1/enterprise-admin/mentors?page=0&size=10
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：200
- 返回分页的导师列表
- 每个导师的role字段值为"EN_TEACHER"

### 2. 更新导师状态

#### 2.1 禁用导师账号
```
PUT /v1/enterprise-admin/mentors/{mentorId}/status?status=inactive
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：200
- 返回成功信息："导师状态更新成功"
- 数据库中对应导师的status字段值为"inactive"

#### 2.2 启用导师账号
```
PUT /v1/enterprise-admin/mentors/{mentorId}/status?status=active
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：200
- 返回成功信息："导师状态更新成功"
- 数据库中对应导师的status字段值为"active"

#### 2.3 设置导师为待审核状态
```
PUT /v1/enterprise-admin/mentors/{mentorId}/status?status=pending_approval
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：200
- 返回成功信息："导师状态更新成功"
- 数据库中对应导师的status字段值为"pending_approval"

#### 2.4 尝试设置无效状态
```
PUT /v1/enterprise-admin/mentors/{mentorId}/status?status=invalid_status
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：400
- 返回错误信息："无效的状态值，可选值为：active, inactive, pending_approval"

#### 2.5 尝试更新已处于该状态的导师
```
PUT /v1/enterprise-admin/mentors/{已禁用的mentorId}/status?status=inactive
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：400
- 返回错误信息："导师已处于该状态"

#### 2.6 尝试更新不存在的导师
```
PUT /v1/enterprise-admin/mentors/9999/status?status=inactive
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：404
- 返回错误信息："导师不存在"

#### 2.7 尝试更新其他企业的导师
```
PUT /v1/enterprise-admin/mentors/{其他企业的mentorId}/status?status=inactive
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：403
- 返回错误信息："权限不足，只能更新本企业导师状态"

### 3. 更新导师基本信息

#### 3.1 更新导师昵称
```
PUT /v1/enterprise-admin/mentors/{mentorId}/info
Authorization: Bearer {token}
Content-Type: application/json

{
  "nickname": "新昵称"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的导师信息，nickname字段值为"新昵称"
- 数据库中对应导师的nickname字段已更新

#### 3.2 更新导师邮箱
```
PUT /v1/enterprise-admin/mentors/{mentorId}/info
Authorization: Bearer {token}
Content-Type: application/json

{
  "email": "newemail@example.com"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的导师信息，email字段值为"newemail@example.com"
- 数据库中对应导师的email字段已更新

#### 3.3 更新导师手机号
```
PUT /v1/enterprise-admin/mentors/{mentorId}/info
Authorization: Bearer {token}
Content-Type: application/json

{
  "phone": "13900001234"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的导师信息，phone字段值为"13900001234"
- 数据库中对应导师的phone字段已更新

#### 3.4 同时更新多个字段
```
PUT /v1/enterprise-admin/mentors/{mentorId}/info
Authorization: Bearer {token}
Content-Type: application/json

{
  "nickname": "全新昵称",
  "email": "brandnew@example.com",
  "phone": "13988889999"
}
```

**预期结果**：
- 状态码：200
- 返回更新后的导师信息，包含所有更新的字段
- 数据库中对应导师的相关字段已全部更新

#### 3.5 使用已存在的邮箱
```
PUT /v1/enterprise-admin/mentors/{mentorId}/info
Authorization: Bearer {token}
Content-Type: application/json

{
  "email": "已存在的邮箱地址"
}
```

**预期结果**：
- 状态码：400
- 返回错误信息："该邮箱已被其他用户使用"

#### 3.6 使用已存在的手机号
```
PUT /v1/enterprise-admin/mentors/{mentorId}/info
Authorization: Bearer {token}
Content-Type: application/json

{
  "phone": "已存在的手机号"
}
```

**预期结果**：
- 状态码：400
- 返回错误信息："该手机号已被其他用户使用"

#### 3.7 尝试更新不存在的导师
```
PUT /v1/enterprise-admin/mentors/9999/info
Authorization: Bearer {token}
Content-Type: application/json

{
  "nickname": "新昵称"
}
```

**预期结果**：
- 状态码：404
- 返回错误信息："导师不存在"

#### 3.8 尝试更新其他企业的导师
```
PUT /v1/enterprise-admin/mentors/{其他企业的mentorId}/info
Authorization: Bearer {token}
Content-Type: application/json

{
  "nickname": "新昵称"
}
```

**预期结果**：
- 状态码：403
- 返回错误信息："权限不足，只能更新本企业导师信息"

### 4. 兼容性测试 - 使用旧版禁用导师接口

```
DELETE /v1/enterprise-admin/mentors/{mentorId}
Authorization: Bearer {token}
```

**预期结果**：
- 状态码：200
- 返回成功信息："导师账号禁用成功"
- 数据库中对应导师的status字段值为"inactive"

## 使用Postman进行测试

1. **创建环境变量**
   - 创建一个新的环境，命名为"Unicorp API测试"
   - 添加变量：
     - `baseUrl`: http://localhost:8081/api
     - `token`: 留空（将在登录后填充）

2. **创建登录请求**
   - 创建POST请求：`{{baseUrl}}/v1/auth/login`
   - 添加请求体：
     ```json
     {
       "loginType": "account",
       "principal": "企业管理员账号",
       "password": "密码"
     }
     ```
   - 添加测试脚本，自动提取token：
     ```javascript
     var jsonData = pm.response.json();
     if (jsonData && jsonData.data && jsonData.data.token) {
         pm.environment.set("token", jsonData.data.token);
     }
     ```

3. **创建集合**
   - 创建一个名为"企业管理员接口"的集合
   - 将所有测试用例添加到集合中
   - 对每个请求：
     - 设置URL为`{{baseUrl}}/v1/enterprise-admin/...`
     - 添加Authorization头：`Bearer {{token}}`
     - 添加适当的请求体和参数

4. **运行测试**
   - 先运行登录请求获取token
   - 然后运行其他请求进行测试
   - 验证每个请求的响应是否符合预期

5. **保存测试结果**
   - 将测试结果导出为HTML或JSON格式，以便记录和分析 