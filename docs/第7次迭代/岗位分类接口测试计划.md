# 岗位分类接口测试计划

## 1. 测试环境

- 测试环境：开发环境
- 测试工具：Postman
- 测试数据库：开发环境数据库
- 测试用户：系统管理员账号和普通用户账号

## 2. 前置条件

1. 服务器已正常启动
2. 数据库已完成初始化，包含V13__job_category.sql迁移脚本
3. 已获取系统管理员的JWT令牌和普通用户的JWT令牌

## 3. 测试用例

### 3.1 创建顶级分类（需要管理员权限）

**请求**:
```
POST /api/v1/admin/job-categories
Content-Type: application/json
Authorization: Bearer {管理员JWT令牌}

{
  "name": "技术"
}
```

**预期结果**:
- 状态码: 200
- 响应体包含成功创建的分类信息，包括id、name、level=1等字段
- 数据库中job_categories表新增一条记录

### 3.2 创建二级分类（需要管理员权限）

**请求**:
```
POST /api/v1/admin/job-categories
Content-Type: application/json
Authorization: Bearer {管理员JWT令牌}

{
  "name": "前端开发",
  "parentId": {上一步创建的分类ID}
}
```

**预期结果**:
- 状态码: 200
- 响应体包含成功创建的分类信息，包括id、name、parentId、level=2等字段
- 数据库中job_categories表新增一条记录

### 3.3 创建三级分类（需要管理员权限）

**请求**:
```
POST /api/v1/admin/job-categories
Content-Type: application/json
Authorization: Bearer {管理员JWT令牌}

{
  "name": "React开发",
  "parentId": {上一步创建的分类ID}
}
```

**预期结果**:
- 状态码: 200
- 响应体包含成功创建的分类信息，包括id、name、parentId、level=3等字段
- 数据库中job_categories表新增一条记录

### 3.4 尝试创建四级分类（预期失败）

**请求**:
```
POST /api/v1/admin/job-categories
Content-Type: application/json
Authorization: Bearer {管理员JWT令牌}

{
  "name": "高级React开发",
  "parentId": {上一步创建的分类ID}
}
```

**预期结果**:
- 状态码: 400
- 响应体包含错误信息："最多支持三级分类"
- 数据库中job_categories表不新增记录

### 3.5 获取所有顶级分类（公开接口）

**请求**:
```
GET /api/v1/job-categories/root
```

**预期结果**:
- 状态码: 200
- 响应体包含所有顶级分类列表，包括上面创建的"技术"分类

### 3.6 获取指定分类的子分类（公开接口）

**请求**:
```
GET /api/v1/job-categories/{技术分类ID}/children
```

**预期结果**:
- 状态码: 200
- 响应体包含"技术"分类下的所有子分类，包括上面创建的"前端开发"分类

### 3.7 获取所有分类（公开接口）

**请求**:
```
GET /api/v1/job-categories
```

**预期结果**:
- 状态码: 200
- 响应体包含所有分类列表，包括上面创建的所有分类

### 3.8 获取分类详情（公开接口）

**请求**:
```
GET /api/v1/job-categories/{前端开发分类ID}
```

**预期结果**:
- 状态码: 200
- 响应体包含"前端开发"分类的详细信息

### 3.9 更新分类（需要管理员权限）

**请求**:
```
PUT /api/v1/admin/job-categories/{前端开发分类ID}
Content-Type: application/json
Authorization: Bearer {管理员JWT令牌}

{
  "name": "前端开发工程师"
}
```

**预期结果**:
- 状态码: 200
- 响应体包含更新后的分类信息
- 数据库中对应记录已更新

### 3.10 尝试删除有子分类的分类（需要管理员权限，预期失败）

**请求**:
```
DELETE /api/v1/admin/job-categories/{技术分类ID}
Authorization: Bearer {管理员JWT令牌}
```

**预期结果**:
- 状态码: 400
- 响应体包含错误信息："该分类下存在子分类，无法删除"
- 数据库中对应记录未删除

### 3.11 删除叶子分类（需要管理员权限）

**请求**:
```
DELETE /api/v1/admin/job-categories/{React开发分类ID}
Authorization: Bearer {管理员JWT令牌}
```

**预期结果**:
- 状态码: 200
- 响应体包含成功信息
- 数据库中对应记录已删除

### 3.12 普通用户尝试创建分类（预期失败）

**请求**:
```
POST /api/v1/admin/job-categories
Content-Type: application/json
Authorization: Bearer {普通用户JWT令牌}

{
  "name": "测试分类"
}
```

**预期结果**:
- 状态码: 403
- 响应体包含权限不足的错误信息

### 3.13 普通用户访问公开查询接口（预期成功）

**请求**:
```
GET /api/v1/job-categories
```

**预期结果**:
- 状态码: 200
- 响应体包含所有分类列表

## 4. Postman测试步骤

1. 创建一个新的Postman Collection，命名为"岗位分类接口测试"
2. 设置Collection级别的变量：
   - `baseUrl`: `http://localhost:8081/api`
   - `adminToken`: 系统管理员JWT令牌
   - `userToken`: 普通用户JWT令牌
   - `categoryId1`: 空（后续填充）
   - `categoryId2`: 空（后续填充）
   - `categoryId3`: 空（后续填充）

3. 创建请求：
   - 创建顶级分类请求，设置Pre-request Script提取并保存返回的ID到`categoryId1`变量
   - 创建二级分类请求，使用`{{categoryId1}}`作为parentId，设置Pre-request Script提取并保存返回的ID到`categoryId2`变量
   - 创建三级分类请求，使用`{{categoryId2}}`作为parentId，设置Pre-request Script提取并保存返回的ID到`categoryId3`变量
   - 其他请求按照测试用例创建

4. 设置每个请求的Tests脚本，验证响应状态码和响应体内容

5. 按顺序运行所有请求，观察测试结果

## 5. 测试结果记录

| 测试用例ID | 测试用例名称 | 测试结果 | 备注 |
|----------|------------|---------|------|
| 3.1 | 创建顶级分类 | | |
| 3.2 | 创建二级分类 | | |
| 3.3 | 创建三级分类 | | |
| 3.4 | 尝试创建四级分类 | | |
| 3.5 | 获取所有顶级分类 | | |
| 3.6 | 获取指定分类的子分类 | | |
| 3.7 | 获取所有分类 | | |
| 3.8 | 获取分类详情 | | |
| 3.9 | 更新分类 | | |
| 3.10 | 尝试删除有子分类的分类 | | |
| 3.11 | 删除叶子分类 | | |
| 3.12 | 普通用户尝试创建分类 | | |
| 3.13 | 普通用户访问公开查询接口 | | |

## 6. 测试总结

待测试完成后填写。 