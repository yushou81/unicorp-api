# 邻客内江 - 迭代一测试计划

## 1. 测试概述

本文档为邻客内江平台第一次迭代的测试计划，主要针对商户信息的读取功能。测试范围包括单元测试、集成测试和API测试，确保商户列表和商户详情的获取功能正常、稳定且高效。

## 2. 测试环境

### 2.1 本地测试环境

- **数据库**：MySQL 8.0
- **测试库名**：linknei_test
- **测试账号**：root/123456
- **API地址**：http://localhost:8081/api

### 2.2 测试工具

- JUnit 5：单元测试框架
- Spring Test：Spring集成测试支持
- Mockito：模拟外部依赖
- Postman：API测试工具
- JMeter：性能测试工具（选用）

## 3. 测试策略

### 3.1 测试层次

我们将采用分层测试策略，自下而上进行测试：

1. **单元测试**：针对Mapper层、Service层的各个组件单独测试
2. **集成测试**：测试多个组件的协同工作
3. **API测试**：从外部调用API，验证端到端功能

### 3.2 测试数据管理

- 使用专用的测试数据库，与开发环境隔离
- 测试开始前使用SQL脚本重置数据库状态
- 每个测试方法使用`@Transactional`注解确保事务回滚，不影响其他测试

## 4. 测试计划详情

### 4.1 Mapper层测试（已完成）

已完成的Mapper层测试覆盖了以下内容：

1. **UserMapper测试**
   - 基本CRUD操作验证
   - 条件查询验证
   - 逻辑删除验证

2. **MerchantMapper测试**
   - 基本CRUD操作验证
   - 分页查询商户列表功能
   - 商户详情（含产品）查询功能
   
3. **ProductMapper测试**
   - 基本CRUD操作验证
   - 根据商户ID查询产品列表功能

### 4.2 Service层测试（待完成）

1. **MerchantService测试**
   - 商户列表分页查询服务
   - 商户详情查询服务
   - 异常处理测试（商户不存在等情况）
   - 业务规则验证（只返回营业中商户等）

测试方法：
- 模拟依赖（使用Mockito模拟Mapper层）
- 验证业务逻辑正确性
- 验证异常处理机制

### 4.3 Controller层测试（待完成）

1. **MerchantController测试**
   - API参数验证
   - 响应格式验证
   - HTTP状态码验证
   - 模拟Service层，专注测试控制器逻辑

测试方法：
- 使用MockMvc模拟HTTP请求
- 验证响应状态和内容
- 验证异常情况下的错误处理

### 4.4 端到端API测试（待完成）

测试所有API端点，确保它们按照OpenAPI规范工作：

1. **GET /merchants/list**
   - 参数验证：page、pageSize
   - 响应格式验证
   - 分页功能验证
   - 边界测试：第一页、最后一页、空结果等

2. **GET /merchants/{id}**
   - 路径参数验证
   - 响应格式验证
   - 存在性验证：已存在ID、不存在ID
   - 关联数据验证：商户包含产品列表

测试方法：
- 使用Postman创建测试集合
- 编写测试脚本验证响应
- 使用环境变量方便切换测试环境

## 5. 测试用例

### 5.1 商户列表API测试用例

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|---------|---------|---------|---------|
| ML-001 | 默认参数获取商户列表 | 数据库中有多个商户 | 调用`GET /merchants/list`不传参数 | 返回状态码200，第1页数据，每页10条记录 |
| ML-002 | 指定页码和页大小 | 数据库中有20+商户 | 调用`GET /merchants/list?page=2&pageSize=5` | 返回状态码200，第2页数据，每页5条记录 |
| ML-003 | 页码超出范围 | 数据库中商户总数有限 | 调用`GET /merchants/list?page=999` | 返回状态码200，list为空数组 |
| ML-004 | 无效的页码参数 | - | 调用`GET /merchants/list?page=-1` | 返回适当错误提示 |

### 5.2 商户详情API测试用例

| 用例ID | 测试场景 | 前置条件 | 测试步骤 | 预期结果 |
|--------|---------|---------|---------|---------|
| MD-001 | 获取存在的商户详情 | 数据库中存在ID为1的商户 | 调用`GET /merchants/1` | 返回状态码200，包含完整商户信息和产品列表 |
| MD-002 | 获取不存在的商户 | 数据库中不存在ID为999的商户 | 调用`GET /merchants/999` | 返回状态码404，适当错误消息 |
| MD-003 | 无效的ID格式 | - | 调用`GET /merchants/abc` | 返回适当的参数错误提示 |
| MD-004 | 获取已删除的商户 | 数据库中有逻辑删除的商户 | 调用该商户的详情接口 | 返回状态码404，商户不存在 |

## 6. 性能测试计划（选做）

使用JMeter进行简单的性能测试，主要关注点：

1. **响应时间**：
   - 商户列表API平均响应时间 < 200ms
   - 商户详情API平均响应时间 < 150ms

2. **并发能力**：
   - 模拟50个并发用户，确保系统稳定运行
   - 验证数据一致性和正确性

## 7. 测试执行和报告

### 7.1 测试流程

1. 准备测试环境和数据
2. 执行单元测试和集成测试（自动化）
3. 执行API测试（手动+自动化）
4. 执行性能测试（如需要）
5. 收集测试结果，生成测试报告

### 7.2 测试报告内容

- 测试覆盖率统计
- 测试通过率
- 发现的缺陷清单
- 性能测试数据（如适用）
- 测试结论和建议

## 8. 测试进度

| 测试阶段 | 计划时间 | 实际时间 | 状态 |
|---------|---------|---------|------|
| Mapper层测试 | 3天 | 3天 | 已完成 |
| Service层测试 | 2天 | - | 待开始 |
| Controller层测试 | 2天 | - | 待开始 |
| API测试 | 2天 | - | 待开始 |
| 性能测试 | 1天 | - | 待开始 |
| 测试报告 | 1天 | - | 待开始 |

## 9. 风险与缓解措施

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|-------|------|---------|
| 测试数据库不稳定 | 中 | 高 | 使用事务回滚，准备备用数据库 |
| 测试环境网络问题 | 低 | 中 | 准备本地Mock服务，减少网络依赖 |
| 测试时间不足 | 中 | 高 | 优先测试核心功能，合理规划测试时间 |

## 10. 结论

本测试计划覆盖了邻客内江平台第一次迭代的所有功能测试，包括单元测试、集成测试和API测试。通过执行本计划，我们能够确保商户信息读取功能的正确性、稳定性和性能符合预期要求。

## 附录：测试代码示例

```java
// Mapper测试示例
@Test
public void testSelectMerchantSummaryPage() {
    Page<MerchantSummaryVO> page = new Page<>(1, 10);
    IPage<MerchantSummaryVO> result = merchantMapper.selectMerchantSummaryPage(page);
    assertNotNull(result);
    assertFalse(result.getRecords().isEmpty());
}

// Service测试示例（计划实现）
@Test
public void testGetMerchantList() {
    // 模拟Mapper返回
    when(merchantMapper.selectMerchantSummaryPage(any())).thenReturn(expectedPage);
    // 调用服务
    PageResultVO<MerchantSummaryVO> result = merchantService.getMerchantList(1, 10);
    // 验证结果
    assertEquals(2, result.getTotal());
    assertEquals(1, result.getPages());
    assertEquals(2, result.getList().size());
}

// Controller测试示例（计划实现）
@Test
public void testGetMerchantList() throws Exception {
    // 模拟Service返回
    when(merchantService.getMerchantList(anyInt(), anyInt())).thenReturn(expectedResult);
    // 执行请求
    mockMvc.perform(get("/merchants/list")
            .param("page", "1")
            .param("pageSize", "10"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(200))
            .andExpect(jsonPath("$.data.list").isArray())
            .andExpect(jsonPath("$.data.total").value(2));
}
``` 