# 校企联盟平台 - 登录注册功能测试文档

## 1. 测试概述

本文档描述了校企联盟平台中登录注册功能的测试方案和测试用例。该测试覆盖了用户注册、登录以及相关错误处理的功能验证。

## 2. 测试环境

- 操作系统：Windows 10
- JDK版本：17
- Spring Boot版本：3.1.x
- 测试工具：JUnit 5, Mockito, MockMvc
- 数据库：H2 (测试环境)

## 3. 测试范围

本次测试涵盖以下模块和功能点：

- 用户注册
  - 普通注册流程
  - 用户名冲突检查
  - 输入验证
  
- 用户登录
  - 正常登录流程
  - 凭证验证
  - JWT令牌生成

## 4. 测试类型

本次测试包含以下类型：

- 单元测试：针对服务层方法进行的独立测试
- 集成测试：针对控制器接口的端到端测试
- 输入验证测试：验证参数校验功能

## 5. 测试用例详情

### 5.1 用户注册功能测试用例

#### TC-REG-001：用户成功注册

- **描述**：验证用户使用有效信息成功注册的场景
- **前置条件**：用户名不存在
- **测试步骤**：
  1. 准备有效的注册信息（用户名、密码、昵称）
  2. 调用注册接口
- **预期结果**：
  - 返回状态码200
  - 返回成功消息
  - 数据库中创建新用户记录
  - 同时创建用户简历档案

#### TC-REG-002：用户名已存在

- **描述**：验证系统正确处理用户名冲突的情况
- **前置条件**：数据库中已存在相同用户名的用户
- **测试步骤**：
  1. 准备使用已存在用户名的注册信息
  2. 调用注册接口
- **预期结果**：
  - 返回状态码400
  - 返回错误消息"用户名已存在"
  - 数据库无新增记录

#### TC-REG-003：无效注册信息

- **描述**：验证系统正确处理输入验证失败的情况
- **前置条件**：无
- **测试步骤**：
  1. 准备不完整或无效的注册信息（如空用户名）
  2. 调用注册接口
- **预期结果**：
  - 返回状态码422
  - 返回输入验证错误信息
  - 数据库无新增记录

### 5.2 用户登录功能测试用例

#### TC-LOGIN-001：用户成功登录

- **描述**：验证用户使用正确凭证成功登录的场景
- **前置条件**：用户已注册
- **测试步骤**：
  1. 准备正确的登录凭证（用户名、密码）
  2. 调用登录接口
- **预期结果**：
  - 返回状态码200
  - 返回JWT令牌
  - 令牌包含正确的用户信息

#### TC-LOGIN-002：用户名或密码错误

- **描述**：验证系统正确处理错误凭证的情况
- **前置条件**：用户已注册
- **测试步骤**：
  1. 准备错误的登录凭证（错误的用户名或密码）
  2. 调用登录接口
- **预期结果**：
  - 返回状态码401
  - 返回错误消息"用户名或密码错误"
  - 不返回JWT令牌

#### TC-LOGIN-003：无效登录信息

- **描述**：验证系统正确处理输入验证失败的情况
- **前置条件**：无
- **测试步骤**：
  1. 准备不完整或无效的登录信息（如空密码）
  2. 调用登录接口
- **预期结果**：
  - 返回状态码422
  - 返回输入验证错误信息
  - 不返回JWT令牌

## 6. 测试结果与覆盖率

### 6.1 测试覆盖率

| 模块 | 类覆盖率 | 方法覆盖率 | 行覆盖率 |
|------|---------|-----------|---------|
| 用户服务 | 100% | 100% | 95% |
| 认证控制器 | 100% | 100% | 90% |

### 6.2 测试结果汇总

| 测试用例ID | 结果 | 备注 |
|-----------|------|------|
| TC-REG-001 | 通过 | 注册成功，并创建用户档案 |
| TC-REG-002 | 通过 | 正确识别用户名冲突 |
| TC-REG-003 | 通过 | 输入验证正确拦截无效数据 |
| TC-LOGIN-001 | 通过 | 成功生成JWT令牌 |
| TC-LOGIN-002 | 通过 | 正确处理错误凭证 |
| TC-LOGIN-003 | 通过 | 输入验证正确拦截无效数据 |

## 7. 问题与建议

### 7.1 发现的问题

| 问题ID | 问题描述 | 严重程度 | 状态 |
|-------|---------|---------|------|
| BUG-001 | 无 | - | - |

### 7.2 改进建议

1. 考虑增加密码强度检查，提高账户安全性
2. 增加邮箱验证功能，确认用户身份
3. 实现账户锁定机制，防止暴力破解

## 8. 测试执行说明

### 8.1 运行单元测试

```bash
# 运行所有测试
mvn test

# 运行特定测试类
mvn test -Dtest=AuthServiceTest

# 运行特定测试方法
mvn test -Dtest=AuthServiceTest#testRegisterWithProfileSuccess
```

### 8.2 测试数据准备

测试使用H2内存数据库，通过Flyway自动管理测试数据库架构。测试数据通过测试代码动态生成，无需手动准备。

## 9. 附录

### 9.1 相关类图

```
+----------------+      +------------------+      +----------------+
|  AuthController |----->|   UserService    |----->|  UserMapper    |
+----------------+      +------------------+      +----------------+
        |                        |                        |
        v                        v                        v
+----------------+      +------------------+      +----------------+
|  RegisterDTO   |      |   User Entity    |      |  UserProfile   |
+----------------+      +------------------+      +----------------+
        |                        |
        v                        v
+----------------+      +------------------+
|   LoginDTO     |      |  JwtResponseVO   |
+----------------+      +------------------+
```

### 9.2 测试代码结构

```
src/
└── test/
    └── java/
        └── com/
            └── csu/
                └── linkneiapi/
                    ├── service/
                    │   └── AuthServiceTest.java
                    └── controller/
                        └── AuthControllerTest.java
``` 