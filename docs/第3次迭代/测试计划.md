# 第三次迭代API测试计划

本文档详细说明第三次迭代API的测试计划，包括合作项目管理相关功能的测试用例和步骤。

## 1. 测试环境准备

### 1.1 测试工具

- Postman
- MySQL数据库客户端

### 1.2 测试前准备

1. 确保应用服务器已启动
2. 准备好以下测试账号：
   - 学校教师账号
   - 企业管理员账号
   - 企业导师账号
   - 学生账号
   - 系统管理员账号

### 1.3 测试变量设置

在Postman中设置以下环境变量：

```
base_url: http://localhost:8081/api
teacher_token: (登录后获取)
enterprise_admin_token: (登录后获取)
enterprise_mentor_token: (登录后获取)
student_token: (登录后获取)
sysadmin_token: (登录后获取)
project_id: (创建项目后获取)
application_id: (提交申请后获取)
```

## 2. 测试用例

### 2.1 用户登录获取Token

#### 2.1.1 教师用户登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body:
  ```json
  {
    "loginType": "account",
    "principal": "教师账号",
    "password": "password123"
  }
  ```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 添加测试脚本:
```javascript
pm.test("保存教师token", function() {
    var jsonData = pm.response.json();
    pm.expect(jsonData.data).to.have.property('token');
    pm.environment.set("teacher_token", jsonData.data.token);
});
```

#### 2.1.2 企业管理员登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body:
  ```json
  {
    "loginType": "account",
    "principal": "企业管理员账号",
    "password": "admin456"
  }
  ```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 添加测试脚本:
```javascript
pm.test("保存企业管理员token", function() {
    var jsonData = pm.response.json();
    pm.expect(jsonData.data).to.have.property('token');
    pm.environment.set("enterprise_admin_token", jsonData.data.token);
});
```

#### 2.1.3 企业导师登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body:
  ```json
  {
    "loginType": "account",
    "principal": "企业导师账号",
    "password": "password123"
  }
  ```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 添加测试脚本:
```javascript
pm.test("保存企业导师token", function() {
    var jsonData = pm.response.json();
    pm.expect(jsonData.data).to.have.property('token');
    pm.environment.set("enterprise_mentor_token", jsonData.data.token);
});
```

#### 2.1.4 学生用户登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body:
  ```json
  {
    "loginType": "account",
    "principal": "学生账号",
    "password": "password123"
  }
  ```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 添加测试脚本:
```javascript
pm.test("保存学生token", function() {
    var jsonData = pm.response.json();
    pm.expect(jsonData.data).to.have.property('token');
    pm.environment.set("student_token", jsonData.data.token);
});
```

### 2.2 测试项目管理API

#### 2.2.1 获取项目列表（公开接口）

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/projects
- 参数:
  - page: 0
  - size: 10
  - keyword: (可选)

**预期结果**:
- 状态码: 200 OK
- 响应包含项目列表

#### 2.2.2 教师创建项目

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/projects
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{teacher_token}}
- Body:
  ```json
  {
    "title": "教育资源共享平台开发",
    "description": "开发一个面向高校的教育资源共享平台，支持课件、视频等多种教学资源的存储和分享"
  }
  ```

**预期结果**:
- 状态码: 201 Created
- 响应包含创建的项目信息
- 添加测试脚本:
```javascript
pm.test("保存项目ID", function() {
    var jsonData = pm.response.json();
    pm.expect(jsonData.data).to.have.property('id');
    pm.environment.set("project_id", jsonData.data.id);
});
```

#### 2.2.3 企业管理员创建项目

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/projects
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_admin_token}}
- Body:
  ```json
  {
    "title": "企业人才培养计划",
    "description": "与高校合作开展企业人才培养计划，包括实习、培训等多种形式"
  }
  ```

**预期结果**:
- 状态码: 201 Created
- 响应包含创建的项目信息

#### 2.2.4 获取项目详情（公开接口）

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/projects/{{project_id}}

**预期结果**:
- 状态码: 200 OK
- 响应包含项目详细信息

#### 2.2.5 教师更新项目

**请求**:
- 方法: PUT
- URL: {{base_url}}/v1/projects/{{project_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{teacher_token}}
- Body:
  ```json
  {
    "title": "高级教育资源共享平台开发",
    "description": "开发一个面向高校的高级教育资源共享平台，支持课件、视频等多种教学资源的存储和分享，并增加智能推荐功能",
    "status": "in_progress"
  }
  ```

**预期结果**:
- 状态码: 200 OK
- 响应包含更新后的项目信息

#### 2.2.6 学生尝试创建项目（权限测试）

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/projects
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}
- Body:
  ```json
  {
    "title": "学生项目",
    "description": "这是一个测试项目"
  }
  ```

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

#### 2.2.7 企业管理员尝试更新其他组织的项目（权限测试）

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

#### 2.2.8 教师删除项目

**请求**:
- 方法: DELETE
- URL: {{base_url}}/v1/projects/{{project_id}}
- Headers: 
  - Authorization: Bearer {{teacher_token}}

**预期结果**:
- 状态码: 204 No Content
- 项目被成功删除

### 2.3 测试项目申请API

#### 2.3.1 学生申请加入项目

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/projects/{{project_id}}/apply
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}
- Body:
  ```json
  {
    "applicationStatement": "我对这个项目非常感兴趣，希望能够参与其中，学习相关技术并贡献自己的力量。"
  }
  ```

**预期结果**:
- 状态码: 201 Created
- 响应包含申请信息
- 添加测试脚本:
```javascript
pm.test("保存申请ID", function() {
    var jsonData = pm.response.json();
    pm.expect(jsonData.data).to.have.property('id');
    pm.environment.set("application_id", jsonData.data.id);
});
```

#### 2.3.2 学生重复申请同一项目（错误测试）

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/projects/{{project_id}}/apply
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}
- Body:
  ```json
  {
    "applicationStatement": "再次申请"
  }
  ```

**预期结果**:
- 状态码: 400 Bad Request
- 响应包含"您已经申请过该项目"的错误信息

#### 2.3.3 非学生用户申请项目（权限测试）

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/projects/{{project_id}}/apply
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{teacher_token}}
- Body:
  ```json
  {
    "applicationStatement": "测试申请"
  }
  ```

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

#### 2.3.4 项目所有者查看申请列表

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/projects/{{project_id}}/applications
- Headers: 
  - Authorization: Bearer {{teacher_token}}

**预期结果**:
- 状态码: 200 OK
- 响应包含申请列表，包括刚才提交的申请

#### 2.3.5 非项目所有者查看申请列表（权限测试）

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/projects/{{project_id}}/applications
- Headers: 
  - Authorization: Bearer {{enterprise_mentor_token}}

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

#### 2.3.6 项目所有者更新申请状态为已查看

**请求**:
- 方法: PATCH
- URL: {{base_url}}/v1/project-applications/{{application_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{teacher_token}}
- Body:
  ```json
  {
    "status": "viewed"
  }
  ```

**预期结果**:
- 状态码: 200 OK
- 响应包含更新后的申请信息，状态为"viewed"

#### 2.3.7 项目所有者更新申请状态为已批准

**请求**:
- 方法: PATCH
- URL: {{base_url}}/v1/project-applications/{{application_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{teacher_token}}
- Body:
  ```json
  {
    "status": "approved"
  }
  ```

**预期结果**:
- 状态码: 200 OK
- 响应包含更新后的申请信息，状态为"approved"

#### 2.3.8 非项目所有者更新申请状态（权限测试）

**请求**:
- 方法: PATCH
- URL: {{base_url}}/v1/project-applications/{{application_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_mentor_token}}
- Body:
  ```json
  {
    "status": "rejected"
  }
  ```

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

#### 2.3.9 学生查看自己的申请列表

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/me/project-applications
- Headers: 
  - Authorization: Bearer {{student_token}}
- 参数:
  - page: 0
  - size: 10

**预期结果**:
- 状态码: 200 OK
- 响应包含学生的申请列表，包括刚才提交的申请及其状态

#### 2.3.10 非学生用户查看学生申请列表（权限测试）

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/me/project-applications
- Headers: 
  - Authorization: Bearer {{teacher_token}}
- 参数:
  - page: 0
  - size: 10

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

## 3. 测试报告

测试完成后，请记录以下信息：

1. 测试时间
2. 测试环境
3. 测试结果摘要：
   - 通过的测试用例数量
   - 失败的测试用例数量
   - 发现的问题清单
4. 问题详情（如有）：
   - 问题描述
   - 复现步骤
   - 预期结果与实际结果的差异
   - 问题严重程度

## 4. 使用Postman进行测试的步骤

1. 导入测试集合：
   - 打开Postman
   - 点击"Import"按钮
   - 选择导入测试集合文件

2. 设置环境变量：
   - 创建新环境
   - 添加必要的变量（base_url, tokens等）
   - 选择该环境

3. 执行测试：
   - 按顺序执行测试用例
   - 对于需要保存变量的测试，检查变量是否正确设置
   - 记录测试结果

4. 生成测试报告：
   - 使用Postman的"Run Collection"功能
   - 导出测试结果 