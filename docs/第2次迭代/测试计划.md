# 第二次迭代API测试计划 v2.0

## 测试环境

- 基础URL: http://localhost:8081/api
- 测试工具: Postman
- 测试数据库: H2/MySQL

## 测试流程

### 1. 准备工作

1. 创建Postman Collection: `校企合作平台API测试-第二次迭代`
2. 添加环境变量:
   - `base_url`: http://localhost:8081/api
   - `jwt_token`: (空，在登录成功后自动填充)
   - `enterprise_token`: (空，在企业用户登录后自动填充)
   - `student_token`: (空，在学生用户登录后自动填充)
   - `job_id`: (空，在创建岗位后自动填充)
   - `application_id`: (空，在申请岗位后自动填充)

### 2. 测试企业用户登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "account",
  "principal": "企业管理员账号",
  "password": "admin456"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 设置测试脚本自动提取token并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data && jsonData.data.token) {
    pm.environment.set("enterprise_token", jsonData.data.token);
    pm.environment.set("jwt_token", jsonData.data.token);
}
```

### 3. 测试创建岗位

**前提条件**: 已成功执行企业用户登录并设置了enterprise_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/jobs
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_token}}
- Body: 
```json
{
  "title": "测试岗位",
  "description": "这是一个测试岗位的详细描述，包含岗位职责、要求等信息",
  "location": "北京市海淀区",
  "salaryMin": 10,
  "salaryMax": 15,
  "salaryUnit": "per_month",
  "jobType": "full_time",
  "headcount": 2,
  "educationRequirement": "bachelor",
  "experienceRequirement": "fresh_graduate",
  "jobCategory": "软件开发",
  "skillTags": "Java,Spring Boot,MySQL",
  "applicationDeadline": "2023-12-31"
}
```

**预期结果**:
- 状态码: 201 Created
- 响应包含创建的岗位ID
- 设置测试脚本自动提取岗位ID:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data) {
    pm.environment.set("job_id", jsonData.data);
}
```

### 4. 测试获取岗位列表

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/jobs
- Headers: Content-Type: application/json
- 参数:
  - page: 0
  - size: 10
  - keyword: 测试

**预期结果**:
- 状态码: 200 OK
- 响应包含岗位列表
- 列表中包含刚才创建的岗位

### 5. 测试获取特定岗位详情

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/jobs/{{job_id}}
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 200 OK
- 响应包含岗位详细信息，包括标题、描述、地点、薪资、工作类型、学历要求、经验要求等
- 验证响应中包含创建时设置的所有字段

### 6. 测试更新岗位信息

**前提条件**: 已成功执行企业用户登录并设置了enterprise_token

**请求**:
- 方法: PUT
- URL: {{base_url}}/v1/jobs/{{job_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_token}}
- Body: 
```json
{
  "title": "更新后的测试岗位",
  "description": "这是更新后的岗位描述",
  "location": "上海市浦东新区",
  "salaryMin": 15,
  "salaryMax": 20,
  "salaryUnit": "per_month",
  "jobType": "full_time",
  "headcount": 3,
  "educationRequirement": "master",
  "experienceRequirement": "less_than_1_year",
  "jobCategory": "软件开发",
  "skillTags": "Java,Spring Boot,MySQL,Redis",
  "applicationDeadline": "2024-01-31"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含更新成功的状态

### 7. 测试学生用户登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "account",
  "principal": "学生账号",
  "password": "password123"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 设置测试脚本自动提取token并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data && jsonData.data.token) {
    pm.environment.set("student_token", jsonData.data.token);
    pm.environment.set("jwt_token", jsonData.data.token);
}
```

### 8. 测试学生申请岗位

**前提条件**: 已成功执行学生用户登录并设置了student_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/jobs/{{job_id}}/apply
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}

**预期结果**:
- 状态码: 201 Created
- 响应包含申请ID
- 设置测试脚本自动提取申请ID:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data) {
    pm.environment.set("application_id", jsonData.data);
}
```

### 9. 测试企业查看岗位申请列表

**前提条件**: 已成功执行企业用户登录并设置了enterprise_token

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/jobs/{{job_id}}/applications
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_token}}
- 参数:
  - page: 0
  - size: 10

**预期结果**:
- 状态码: 200 OK
- 响应包含申请列表
- 列表中包含刚才提交的申请信息

### 10. 测试企业更新申请状态

**前提条件**: 已成功执行企业用户登录并设置了enterprise_token，并且已有申请记录

**请求**:
- 方法: PATCH
- URL: {{base_url}}/v1/applications/{{application_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_token}}
- Body: 
```json
{
  "status": "interviewing"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含更新后的申请状态为"interviewing"

### 11. 测试学生查看自己的申请列表

**前提条件**: 已成功执行学生用户登录并设置了student_token

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/me/applications
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}
- 参数:
  - page: 0
  - size: 10

**预期结果**:
- 状态码: 200 OK
- 响应包含申请列表
- 列表中包含刚才提交的申请信息，且状态为"interviewing"

### 12. 测试删除岗位

**前提条件**: 已成功执行企业用户登录并设置了enterprise_token

**请求**:
- 方法: DELETE
- URL: {{base_url}}/v1/jobs/{{job_id}}
- Headers: 
  - Authorization: Bearer {{enterprise_token}}

**预期结果**:
- 状态码: 204 No Content
- 无响应体

## 测试失败场景

### 1. 测试无权限创建岗位

**前提条件**: 已成功执行学生用户登录并设置了student_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/jobs
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}
- Body: 
```json
{
  "title": "无权限创建的岗位",
  "description": "这个岗位不应该被创建",
  "location": "北京市",
  "jobType": "internship"
}
```

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

### 2. 测试重复申请岗位

**前提条件**: 已成功执行学生申请岗位的测试

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/jobs/{{job_id}}/apply
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}

**预期结果**:
- 状态码: 400 Bad Request
- 响应包含"已申请过该岗位"的错误信息

### 3. 测试无权限查看申请列表

**前提条件**: 已成功执行学生用户登录并设置了student_token

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/jobs/{{job_id}}/applications
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

### 4. 测试无权限更新申请状态

**前提条件**: 已成功执行学生用户登录并设置了student_token

**请求**:
- 方法: PATCH
- URL: {{base_url}}/v1/applications/{{application_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{student_token}}
- Body: 
```json
{
  "status": "interviewing"
}
```

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含权限不足的错误信息

### 5. 测试无效的申请状态值

**前提条件**: 已成功执行企业用户登录并设置了enterprise_token

**请求**:
- 方法: PATCH
- URL: {{base_url}}/v1/applications/{{application_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_token}}
- Body: 
```json
{
  "status": "invalid_status"
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 响应包含"无效的状态值"的错误信息

### 6. 测试访问不存在的岗位

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/jobs/9999
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 404 Not Found
- 响应包含"岗位不存在"的错误信息

### 7. 测试缺少必填字段创建岗位

**前提条件**: 已成功执行企业用户登录并设置了enterprise_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/jobs
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_token}}
- Body: 
```json
{
  "title": "缺少必填字段的岗位",
  "description": "这个岗位缺少必填字段jobType"
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 响应包含"jobType不能为空"的错误信息

### 8. 测试无效的薪资单位

**前提条件**: 已成功执行企业用户登录并设置了enterprise_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/jobs
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{enterprise_token}}
- Body: 
```json
{
  "title": "无效薪资单位的岗位",
  "description": "这个岗位使用了无效的薪资单位",
  "location": "北京市",
  "jobType": "full_time",
  "salaryMin": 10,
  "salaryMax": 15,
  "salaryUnit": "invalid_unit"
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 响应包含"无效的薪资单位"的错误信息

## 测试注意事项

1. 确保测试顺序正确，先创建数据再进行其他操作
2. 测试前确保数据库中已有企业用户和学生用户
3. 记得检查返回的错误码和错误消息是否符合预期
4. 在每个请求后验证响应状态码和响应体的格式与内容
5. 测试删除岗位后，应验证该岗位不再出现在岗位列表中
6. 注意权限控制的测试，确保不同角色的用户只能访问其有权限的资源
7. 测试申请状态更新后，确保学生查看自己的申请列表时能看到最新状态

## Postman测试方法

1. 导入测试计划中的API请求到Postman
2. 创建环境变量并设置base_url
3. 按照测试流程顺序执行请求
4. 使用Postman的测试脚本功能验证响应和自动设置环境变量
5. 记录测试结果，包括成功和失败的情况

## 测试报告格式

测试完成后，应生成测试报告，包含以下内容：

1. 测试环境信息
2. 测试执行日期和时间
3. 测试结果摘要（通过/失败数量）
4. 详细测试结果，包括每个API的请求和响应
5. 发现的问题和建议
6. 测试结论 