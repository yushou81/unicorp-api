# 第一次迭代API测试计划 v6.0

## 测试环境

- 基础URL: http://localhost:8080/api
- 测试工具: Postman
- 测试数据库: H2/MySQL

## 测试流程

### 1. 准备工作

1. 创建Postman Collection: `校企合作平台API测试`
2. 添加环境变量:
   - `base_url`: http://localhost:8080/api
   - `jwt_token`: (空，在登录成功后自动填充)
   - `student_email`: (空，在注册学生后自动填充)
   - `student_account`: (空，在注册学生后自动填充)
   - `enterprise_email`: (空，在注册企业后自动填充)
   - `enterprise_account`: (空，在注册企业后自动填充)
   - `school_admin_email`: (空，在创建学校后自动填充)
   - `school_admin_account`: (空，在创建学校后自动填充)
   - `teacher_account`: (空，在创建教师后自动填充)
   - `mentor_account`: (空，在创建企业导师后自动填充)

### 2. 测试系统管理员登录（通过账号登录）

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "account",
  "principal": "admin1",
  "password": "admin123"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 设置测试脚本自动提取token并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.token) {
    pm.environment.set("jwt_token", jsonData.token);
}
```

### 3. 测试创建学校

**前提条件**: 已成功执行管理员登录并设置了jwt_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/admin/organizations/schools
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "organizationName": "测试大学",
  "description": "这是一所测试用的大学",
  "address": "测试市测试区测试路123号",
  "website": "http://www.testuniversity.edu",
  "adminNickname": "校管理员",
  "adminPassword": "admin123",
  "adminEmail": "school_admin@test.edu"
}
```

**预期结果**:
- 状态码: 201 Created
- 响应包含学校信息和系统自动生成的管理员账号（格式为"admin_xxx"）
- 设置测试脚本自动提取学校ID和管理员账号:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data) {
    pm.environment.set("school_id", jsonData.data.id);
    pm.environment.set("school_admin_email", "school_admin@test.edu");
}
```

### 4. 测试查询学校列表（简化版）

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/organizations/schools
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 200 OK
- 响应包含学校列表（简化版，只有id和organizationName字段）
- 列表中包含刚才创建的学校

### 4.1 测试查询学校列表（详细版）

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/organizations/schools?view=detailed
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 200 OK
- 响应包含学校列表（详细版，包含id、organizationName、type、description、website、address等字段）
- 列表中包含刚才创建的学校

### 4.2 测试查询企业列表（简化版）

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/organizations/enterprises
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 200 OK
- 响应包含企业列表（简化版，只有id和organizationName字段）
- 列表中包含已审核通过的企业

### 4.3 测试查询企业列表（详细版）

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/organizations/enterprises?view=detailed
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 200 OK
- 响应包含企业列表（详细版，包含id、organizationName、type、description、website、address等字段）
- 列表中包含已审核通过的企业

### 4.4 测试获取单个学校详情

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/organizations/schools/{{school_id}}
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 200 OK
- 响应包含学校详细信息，包含id、organizationName、type、description、website、address等字段

### 4.5 测试获取单个企业详情

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/organizations/enterprises/{{enterprise_id}}
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 200 OK
- 响应包含企业详细信息，包含id、organizationName、type、description、website、address等字段

### 4.6 测试获取不存在的学校详情

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/organizations/schools/9999
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 404 Not Found
- 响应包含错误信息，说明学校不存在或未通过审核

### 4.7 测试获取不存在的企业详情

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/organizations/enterprises/9999
- Headers: Content-Type: application/json

**预期结果**:
- 状态码: 404 Not Found
- 响应包含错误信息，说明企业不存在或未通过审核

### 5. 测试学生注册

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/register/student
- Headers: Content-Type: application/json
- Body: 
```json
{
  "nickname": "测试学生",
  "password": "password123",
  "email": "student1@test.edu",
  "phone": "13800138000",
  "organizationId": 1,
  "realName": "张三",
  "idCard": "110101200001010011"
}
```

**预期结果**:
- 状态码: 201 Created
- 响应包含学生用户信息，包括系统生成的账号
- 设置测试脚本自动提取邮箱和账号并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data) {
    pm.environment.set("student_email", jsonData.data.email);
    pm.environment.set("student_account", jsonData.data.account);
}
```

### 6. 测试企业注册

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/register/enterprise
- Headers: Content-Type: application/json
- Body: 
```json
{
  "organizationName": "测试企业",
  "description": "这是一家测试企业",
  "address": "测试市测试区企业路456号",
  "website": "http://www.testenterprise.com",
  "industry": "互联网/IT",
  "companySize": "100-499人",
  "businessLicenseUrl": "http://example.com/license/12345.jpg",
  "adminNickname": "企业管理员",
  "adminPassword": "admin456",
  "adminEmail": "enterprise_admin@test.com",
  "adminPhone": "13900139000"
}
```

**预期结果**:
- 状态码: 202 Accepted
- 响应包含企业管理员用户信息，状态为"pending"
- 设置测试脚本自动提取邮箱和账号并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data) {
    pm.environment.set("enterprise_email", jsonData.data.email);
    pm.environment.set("enterprise_account", jsonData.data.account);
    pm.environment.set("enterprise_id", jsonData.data.organizationId);
}
```

### 7. 测试通过邮箱登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "email",
  "principal": "{{student_email}}",
  "password": "password123"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 设置测试脚本自动提取token并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.token) {
    pm.environment.set("jwt_token", jsonData.token);
}
```

### 8. 测试通过账号登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "account",
  "principal": "{{student_account}}",
  "password": "password123"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含token

### 9. 测试通过手机号登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "phone",
  "principal": "13800138000",
  "password": "password123"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含token

### 10. 测试获取当前用户信息

**前提条件**: 已成功执行登录并设置了jwt_token

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/auth/me
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}

**预期结果**:
- 状态码: 200 OK
- 响应包含当前登录用户的信息
- 用户信息中的account应是系统生成的账号格式（如"tdu25xxxxx"）

### 11. 测试企业审核通过

**前提条件**: 已成功执行管理员登录并设置了jwt_token，已有企业注册申请

**请求**:
- 方法: PUT
- URL: {{base_url}}/v1/admin/enterprises/{{enterprise_id}}/approve
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}

**预期结果**:
- 状态码: 200 OK
- 响应包含更新后的企业信息，状态为"active"

### 12. 测试企业登录（审核通过后）

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "email",
  "principal": "{{enterprise_email}}",
  "password": "admin456"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 设置测试脚本自动提取token并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.token) {
    pm.environment.set("jwt_token", jsonData.token);
}
```

### 13. 测试学校管理员登录

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "email",
  "principal": "{{school_admin_email}}",
  "password": "admin123"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含token
- 设置测试脚本自动提取token并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.token) {
    pm.environment.set("jwt_token", jsonData.token);
}
```

### 14. 测试学校管理员创建教师账号

**前提条件**: 已成功执行学校管理员登录并设置了jwt_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/school-admin/teachers
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "email": "teacher1@test.edu",
  "nickname": "测试教师",
  "password": "teacher123",
  "phone": "13811138111"
}
```

**预期结果**:
- 状态码: 201 Created
- 响应包含教师用户信息，包括系统生成的账号
- 设置测试脚本自动提取邮箱和账号并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data) {
    pm.environment.set("teacher_email", jsonData.data.email);
    pm.environment.set("teacher_account", jsonData.data.account);
    pm.environment.set("teacher_id", jsonData.data.id);
}
```

### 15. 测试学校管理员获取教师列表

**前提条件**: 已成功执行学校管理员登录并设置了jwt_token

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/school-admin/teachers?page=0&size=10
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}

**预期结果**:
- 状态码: 200 OK
- 响应包含教师列表，包括刚才创建的教师

### 16. 测试学校管理员更新教师信息

**前提条件**: 已成功执行学校管理员登录并设置了jwt_token，已创建教师账号

**请求**:
- 方法: PUT
- URL: {{base_url}}/v1/school-admin/teachers/{{teacher_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "nickname": "更新后的教师昵称",
  "phone": "13811138112"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含更新后的教师信息

### 17. 测试学校管理员禁用教师账号

**前提条件**: 已成功执行学校管理员登录并设置了jwt_token，已创建教师账号

**请求**:
- 方法: DELETE
- URL: {{base_url}}/v1/school-admin/teachers/{{teacher_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}

**预期结果**:
- 状态码: 204 No Content
- 无响应体

### 18. 测试企业管理员创建企业导师账号

**前提条件**: 已成功执行企业管理员登录并设置了jwt_token，企业已审核通过

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/enterprise-admin/mentors
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "email": "mentor1@test.com",
  "nickname": "测试导师",
  "password": "mentor123",
  "phone": "13822238222"
}
```

**预期结果**:
- 状态码: 201 Created
- 响应包含导师用户信息，包括系统生成的账号
- 设置测试脚本自动提取邮箱和账号并保存到环境变量:
```javascript
var jsonData = pm.response.json();
if (jsonData && jsonData.data) {
    pm.environment.set("mentor_email", jsonData.data.email);
    pm.environment.set("mentor_account", jsonData.data.account);
    pm.environment.set("mentor_id", jsonData.data.id);
}
```

### 19. 测试企业管理员获取导师列表

**前提条件**: 已成功执行企业管理员登录并设置了jwt_token

**请求**:
- 方法: GET
- URL: {{base_url}}/v1/enterprise-admin/mentors?page=0&size=10
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}

**预期结果**:
- 状态码: 200 OK
- 响应包含导师列表，包括刚才创建的导师

### 20. 测试企业管理员更新导师信息

**前提条件**: 已成功执行企业管理员登录并设置了jwt_token，已创建导师账号

**请求**:
- 方法: PUT
- URL: {{base_url}}/v1/enterprise-admin/mentors/{{mentor_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "nickname": "更新后的导师昵称",
  "phone": "13822238223"
}
```

**预期结果**:
- 状态码: 200 OK
- 响应包含更新后的导师信息

### 21. 测试企业管理员禁用导师账号

**前提条件**: 已成功执行企业管理员登录并设置了jwt_token，已创建导师账号

**请求**:
- 方法: DELETE
- URL: {{base_url}}/v1/enterprise-admin/mentors/{{mentor_id}}
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}

**预期结果**:
- 状态码: 204 No Content
- 无响应体

## 测试失败场景

### 1. 测试注册时使用已存在的邮箱

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/register/student
- Headers: Content-Type: application/json
- Body: 
```json
{
  "nickname": "重复邮箱测试",
  "password": "password123",
  "email": "{{student_email}}",
  "organizationId": 1,
  "realName": "李四",
  "idCard": "110101200001010022"
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 响应包含"该邮箱已被注册"的错误消息

### 2. 测试注册时使用已存在的手机号

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/register/student
- Headers: Content-Type: application/json
- Body: 
```json
{
  "nickname": "重复手机号测试",
  "password": "password123",
  "email": "another_student@test.edu",
  "phone": "13800138000",
  "organizationId": 1,
  "realName": "王五",
  "idCard": "110101200001010033"
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 响应包含"该手机号已被注册"的错误消息

### 3. 测试登录时使用不存在的账号

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "account",
  "principal": "nonexistent_account",
  "password": "password123"
}
```

**预期结果**:
- 状态码: 401 Unauthorized
- 响应包含"用户不存在"的错误消息

### 4. 测试企业注册时使用已存在的企业名称

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/register/enterprise
- Headers: Content-Type: application/json
- Body: 
```json
{
  "organizationName": "测试企业",
  "description": "这是另一家同名企业",
  "address": "测试市测试区企业路789号",
  "website": "http://www.anothertest.com",
  "industry": "教育",
  "companySize": "10-99人",
  "businessLicenseUrl": "http://example.com/license/67890.jpg",
  "adminNickname": "另一个企业管理员",
  "adminPassword": "admin789",
  "adminEmail": "another_admin@test.com",
  "adminPhone": "13700137000"
}
```

**预期结果**:
- 状态码: 400 Bad Request
- 响应包含"该企业名称已被注册"的错误消息

### 5. 测试未审核企业管理员登录

**前提条件**: 已注册企业但未审核通过

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/auth/login
- Headers: Content-Type: application/json
- Body: 
```json
{
  "loginType": "email",
  "principal": "{{enterprise_email}}",
  "password": "admin456"
}
```

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含"账号待审核"的错误消息

### 6. 测试非学校管理员创建教师账号

**前提条件**: 已成功执行学生登录并设置了jwt_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/school-admin/teachers
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "email": "teacher2@test.edu",
  "nickname": "测试教师2",
  "password": "teacher456",
  "phone": "13833338333"
}
```

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含"权限不足"的错误消息

### 7. 测试非企业管理员创建企业导师账号

**前提条件**: 已成功执行学生登录并设置了jwt_token

**请求**:
- 方法: POST
- URL: {{base_url}}/v1/enterprise-admin/mentors
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "email": "mentor2@test.com",
  "nickname": "测试导师2",
  "password": "mentor456",
  "phone": "13844448444"
}
```

**预期结果**:
- 状态码: 403 Forbidden
- 响应包含"权限不足"的错误消息

### 8. 测试学校管理员更新非本校教师信息

**前提条件**: 已成功执行学校管理员登录并设置了jwt_token

**请求**:
- 方法: PUT
- URL: {{base_url}}/v1/school-admin/teachers/999 (假设999是不存在的或非本校的教师ID)
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "nickname": "非本校教师",
  "phone": "13899998888"
}
```

**预期结果**:
- 状态码: 403 Forbidden 或 404 Not Found
- 响应包含"权限不足"或"用户不存在"的错误消息

### 9. 测试企业管理员更新非本企业导师信息

**前提条件**: 已成功执行企业管理员登录并设置了jwt_token

**请求**:
- 方法: PUT
- URL: {{base_url}}/v1/enterprise-admin/mentors/999 (假设999是不存在的或非本企业的导师ID)
- Headers: 
  - Content-Type: application/json
  - Authorization: Bearer {{jwt_token}}
- Body: 
```json
{
  "nickname": "非本企业导师",
  "phone": "13877778888"
}
```

**预期结果**:
- 状态码: 403 Forbidden 或 404 Not Found
- 响应包含"权限不足"或"用户不存在"的错误消息

## 测试注意事项

1. 确保测试顺序正确，先创建数据再进行其他操作
2. 验证系统生成的账号格式是否符合预期（学校简称 + 年份后两位 + 5位递增序号）
3. 测试所有三种登录方式：账号、邮箱和手机号
4. 记得检查返回的错误码和错误消息是否符合预期
5. 在每个请求后验证响应状态码和响应体的格式与内容
6. 企业相关测试需要确保审核流程正常工作
7. 测试企业状态变更后的权限变化
8. 测试学校管理员和企业管理员的特殊权限
9. 验证禁用账号后，该账号是否仍能登录（预期不能）
10. 测试更新信息后，获取用户信息是否正确反映更新

