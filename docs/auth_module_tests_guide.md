# 认证模块测试指南

本文档提供了如何使用Postman测试集合来测试校企合作平台认证模块的指南。

## 准备工作

1. 安装 [Postman](https://www.postman.com/downloads/)
2. 导入测试集合：
   - 打开Postman
   - 点击左上角的"Import"按钮
   - 选择`docs/auth_module_tests.postman_collection.json`文件

## 创建环境变量

1. 点击右上角的"管理环境"图标（齿轮图标）
2. 点击"添加"按钮创建新环境
3. 命名环境（例如"校企合作平台-本地"）
4. 添加以下变量：
   - `base_url`: 设置为您的API基础URL（例如`http://localhost:8080`）
5. 点击"保存"按钮

## 测试流程

按照以下顺序执行测试用例：

### 1. 用户登录

测试用户登录功能。成功登录后，会自动将访问令牌和刷新令牌存储到环境变量中。

**请求参数说明：**
- `loginType`: 登录类型（account/email/phone）
- `principal`: 用户账号/邮箱/手机号
- `password`: 密码

**预期结果：**
- 状态码：200
- 响应包含访问令牌和刷新令牌

### 2. 获取当前用户信息

测试使用访问令牌获取当前登录用户信息的功能。

**预期结果：**
- 状态码：200
- 响应包含用户ID、账号和昵称等信息

### 3. 刷新令牌

测试使用刷新令牌获取新的访问令牌的功能。成功后，会自动更新环境变量中的令牌。

**请求参数说明：**
- `refreshToken`: 刷新令牌（自动从环境变量获取）

**预期结果：**
- 状态码：200
- 响应包含新的访问令牌和刷新令牌

### 4. 用户登出

测试用户登出功能，使当前令牌失效。

**预期结果：**
- 状态码：200
- 响应消息包含"登出成功"

### 5. 使用已登出的令牌访问

测试使用已登出的令牌访问受保护资源的情况。

**预期结果：**
- 状态码：401（未授权）

### 6. 多次错误密码登录

测试登录尝试次数限制功能。多次使用错误密码尝试登录，观察剩余尝试次数的变化。

**请求参数说明：**
- `loginType`: 登录类型（account/email/phone）
- `principal`: 用户账号/邮箱/手机号
- `password`: 错误的密码

**预期结果：**
- 状态码：401（未授权）
- 响应消息包含剩余尝试次数信息

**注意：** 连续多次执行此测试（5次以上），账户将被锁定。

## 自动化测试

Postman测试集合中包含了自动化测试脚本，可以自动验证响应是否符合预期。执行测试后，可以在Postman界面右侧查看测试结果。

## 故障排除

如果测试失败，请检查以下几点：

1. 确保API服务器正在运行
2. 确保环境变量`base_url`设置正确
3. 确保测试用户账号存在且密码正确
4. 检查Redis服务是否正常运行
5. 查看服务器日志以获取更详细的错误信息 